{% extends 'website/base.html' %}
{% load static %}

{% block title %}ভর্তি - {{ school_name }}{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <!-- Header Section -->
    <div class="container max-w-[90rem] mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                <i class="fas fa-user-plus text-blue-600 mr-3"></i>
                ভর্তি তথ্য
            </h1>
            <p class="text-gray-600 text-lg">সকল শ্রেণির ভর্তি সংক্রান্ত তথ্য এখানে পাবেন</p>
        </div>

        <!-- Filter Section -->
        <div 
            x-data="{ 
                activeFilter: 'all',
                admissions: [],
                loading: false,
                filteredAdmissions: [],
                
                init() {
                    this.loadAllAdmissions();
                },
                
                setFilter(filter) {
                    this.activeFilter = filter;
                    this.applyFilter();
                },
                
                async loadAllAdmissions() {
                    this.loading = true;
                    try {
                        const response = await fetch('/filter-admissions/');
                        const data = await response.json();
                        this.admissions = data.admissions || [];
                        this.filteredAdmissions = this.admissions;
                    } catch (error) {
                        console.error('Error loading admissions:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                
                async applyFilter() {
                    this.loading = true;
                    try {
                        let url = '/filter-admissions/';
                        const params = new URLSearchParams();
                        
                        if (this.activeFilter !== 'all') {
                            if (this.activeFilter.startsWith('class-')) {
                                params.append('class_id', this.activeFilter.replace('class-', ''));
                            } else {
                                params.append('dept_slug', this.activeFilter);
                            }
                        }
                        
                        if (params.toString()) {
                            url += '?' + params.toString();
                        }
                        
                        const response = await fetch(url);
                        const data = await response.json();
                        this.filteredAdmissions = data.admissions || [];
                    } catch (error) {
                        console.error('Error filtering admissions:', error);
                    } finally {
                        this.loading = false;
                    }
                }
            }"
            class="space-y-6"
        >
            <!-- Filter Tabs -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-filter text-blue-600 mr-2"></i>
                    ফিল্টার করুন
                </h3>
                
                <!-- Filter Buttons -->
                <div class="flex flex-wrap gap-2 mb-4">
                    <button 
                        @click="setFilter('all')"
                        :class="activeFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                        class="px-4 py-2 rounded-lg font-medium transition-colors duration-200"
                    >
                        সকল ভর্তি
                    </button>
                    
                    <!-- Class Filters -->
                    {% for class in classes %}
                    <button 
                        @click="setFilter('class-{{ class.id }}')"
                        :class="activeFilter === 'class-{{ class.id }}' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                        class="px-4 py-2 rounded-lg font-medium transition-colors duration-200"
                    >
                        {{ class.name }}
                    </button>
                    {% endfor %}
                    
                    <!-- Department Filters -->
                    {% for department in departments %}
                    <button 
                        @click="setFilter('{{ department.slug }}')"
                        :class="activeFilter === '{{ department.slug }}' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
                        class="px-4 py-2 rounded-lg font-medium transition-colors duration-200"
                    >
                        {{ department.name }}
                    </button>
                    {% endfor %}
                </div>
            </div>

            <!-- Loading State -->
            <div x-show="loading" class="text-center py-8">
                <div class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    লোড হচ্ছে...
                </div>
            </div>

            <!-- Admissions Grid -->
            <div x-show="!loading && filteredAdmissions.length > 0" class="grid gap-6">
                <!-- Desktop Table View -->
                <div class="hidden md:block bg-white rounded-lg shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
                                <tr>
                                    <th class="px-6 py-4 text-left font-semibold">শিরোনাম</th>
                                    <th class="px-6 py-4 text-left font-semibold">শ্রেণি</th>
                                    <th class="px-6 py-4 text-left font-semibold">বিভাগ</th>
                                    <th class="px-6 py-4 text-left font-semibold">আপডেট</th>
                                    <th class="px-6 py-4 text-center font-semibold">অ্যাকশন</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <template x-for="admission in filteredAdmissions" :key="admission.id">
                                    <tr class="hover:bg-gray-50 transition-colors duration-200">
                                        <td class="px-6 py-4">
                                            <div class="flex items-center">
                                                <i class="fas fa-file-pdf text-red-500 mr-3"></i>
                                                <span class="font-medium text-gray-900" x-text="admission.title"></span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-gray-700" x-text="admission.class_name || 'সকল শ্রেণি'"></td>
                                        <td class="px-6 py-4 text-gray-700" x-text="admission.department || 'সকল বিভাগ'"></td>
                                        <td class="px-6 py-4 text-gray-600" x-text="admission.updated_at"></td>
                                        <td class="px-6 py-4">
                                            <div class="flex justify-center space-x-2">
                                                <a 
                                                    :href="admission.file_url" 
                                                    target="_blank"
                                                    class="inline-flex items-center px-3 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors duration-200"
                                                    title="দেখুন"
                                                >
                                                    <i class="fas fa-eye mr-1"></i>
                                                    দেখুন
                                                </a>
                                                <a 
                                                    :href="admission.download_url"
                                                    class="inline-flex items-center px-3 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200"
                                                    title="ডাউনলোড"
                                                >
                                                    <i class="fas fa-download mr-1"></i>
                                                    ডাউনলোড
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Mobile Card View -->
                <div class="md:hidden space-y-4">
                    <template x-for="admission in filteredAdmissions" :key="admission.id">
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900 mb-2" x-text="admission.title"></h3>
                                    <div class="space-y-1 text-sm text-gray-600">
                                        <div class="flex items-center">
                                            <i class="fas fa-graduation-cap w-4 mr-2"></i>
                                            <span x-text="admission.class_name || 'সকল শ্রেণি'"></span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-building w-4 mr-2"></i>
                                            <span x-text="admission.department || 'সকল বিভাগ'"></span>
                                        </div>
                                        <div class="flex items-center">
                                            <i class="fas fa-calendar w-4 mr-2"></i>
                                            <span x-text="admission.updated_at"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-3">
                                <a 
                                    :href="admission.file_url" 
                                    target="_blank"
                                    class="flex-1 inline-flex items-center justify-center px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors duration-200"
                                >
                                    <i class="fas fa-eye mr-2"></i>
                                    দেখুন
                                </a>
                                <a 
                                    :href="admission.download_url"
                                    class="flex-1 inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200"
                                >
                                    <i class="fas fa-download mr-2"></i>
                                    ডাউনলোড
                                </a>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- No Data State -->
            <div x-show="!loading && filteredAdmissions.length === 0" class="text-center py-12">
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <i class="fas fa-inbox text-gray-400 text-6xl mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">কোন ভর্তি তথ্য পাওয়া যায়নি</h3>
                    <p class="text-gray-500">বর্তমানে এই ফিল্টারে কোন ভর্তি তথ্য উপলব্ধ নেই।</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
